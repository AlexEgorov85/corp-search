# üß† Multi-Agent Reasoning Framework (ReAct)

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–≥–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã **ReAct** (Reason + Act), –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ —Å–∏–Ω—Ç–µ–∑–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, API –∏ —Ç.–¥.).

---

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤**: —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –ø–æ–¥–≤–æ–ø—Ä–æ—Å—ã.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.
- **–í—ã–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL**: NL ‚Üí SQL —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å—Ö–µ–º—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- **–°–∏–Ω—Ç–µ–∑ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞**: –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ–≥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ LLM-–±—ç–∫–µ–Ω–¥–æ–≤**: `llama.cpp`, `OpenAI`, –º–æ–∫–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã.
- **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ø—Ä–æ—Ñ–∏–ª–∏ LLM, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ `settings.py`.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

### üß≠ Control Agents (—É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∞–≥–µ–Ω—Ç—ã)

| –ê–≥–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| **PlannerAgent** | –î–µ–∫–æ–º–ø–æ–∑–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–≤–æ–ø—Ä–æ—Å—ã –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–ª–∞–Ω. |
| **ReasonerAgent** | –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥–≤–æ–ø—Ä–æ—Å—ã, –≤—ã–±–∏—Ä–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞–¥–∏—è–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. |
| **ExecutorAgent** | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É. |
| **SynthesizerAgent** | –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—Å–µ—Ö —à–∞–≥–æ–≤. |

### üõ†Ô∏è Tool Agents (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã)

| –ê–≥–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| **BooksLibraryAgent** | –†–∞–±–æ—Ç–∞ —Å –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–π –ë–î: –ø–æ–∏—Å–∫ –∫–Ω–∏–≥, –∞–≤—Ç–æ—Ä–æ–≤, –≥–ª–∞–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π NL ‚Üí SQL. |
| **DataAnalysisAgent** | –ê–≥—Ä–µ–≥–∞—Ü–∏—è, —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (map/reduce). |

### üì¶ –°–µ—Ä–≤–∏—Å—ã

- **LLM Service**: —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM (—Ñ–∞–±—Ä–∏–∫–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–¥–∞–ø—Ç–µ—Ä—ã).
- **DB Service**: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ª–∏–º–∏—Ç–∞–º–∏.
- **Agent Registry**: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –∞–≥–µ–Ω—Ç–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
- **AgentResult**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤.

### üîÑ –ì—Ä–∞—Ñ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (LangGraph)

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ü–∏–∫–ª–µ:

```
[Planner] ‚Üí [Next Subquestion?] ‚Üí (–¥–∞) ‚Üí [Reasoner] ‚Üí [Executor] ‚Üí ‚Ü∫
                                   ‚Üì (–Ω–µ—Ç)
                               [Synthesizer] ‚Üí [–û—Ç–≤–µ—Ç]
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: `requirements.txt` –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –∞—Ä—Ö–∏–≤, –Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã –≤–∫–ª—é—á–∞—é—Ç:
> - `langgraph`, `langchain`
> - `sqlalchemy`, `psycopg2`
> - `llama-cpp-python` (–∏–ª–∏ `openai`)
> - `fastapi`, `uvicorn` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
POSTGRES_DSN=postgresql+psycopg2://user:pass@localhost:5432/db
LLM_BACKEND=llama_cpp
LLM_MODEL_PATH=C:\models\Phi-3-mini-4k-instruct-fp16.gguf
LLM_N_CTX=4090
LLM_TEMPERATURE=0.1
```

–ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `src/common/settings.py`.

### 3. –ó–∞–ø—É—Å–∫ –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
python main.py
```

–ü—Ä–∏–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ –≤ –∫–æ–¥–µ:
> _¬´–ù–∞–π–¥–∏ –∫–Ω–∏–≥–∏ –ü—É—à–∫–∏–Ω–∞ –∏ —É–∫–∞–∂–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–∑ –Ω–∏—Ö?¬ª_

### 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ API (FastAPI)

```bash
uvicorn src.api.main:app --reload
```

–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:

```bash
curl -X POST http://localhost:8000/query \
  -H "Content-Type: application/json" \
  -d '{"question": "–ö–∞–∫–∏–µ –∞–∫—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–∫–∞–∑–æ–≤ –ë–∞–Ω–∫–∞?"}'
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –º–æ–¥—É–ª—å–Ω—ã–µ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:

```bash
pytest tests/
```

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏
- –í—ã–±–æ—Ä –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –†–∞–±–æ—Ç—É —Å LLM –∏ –ë–î
- –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ –≤ –ø–æ–ª–Ω–æ–º —Ü–∏–∫–ª–µ

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ agents/                 # –í—Å–µ –∞–≥–µ–Ω—Ç—ã (control + tool)
‚îÇ   ‚îú‚îÄ‚îÄ PlannerAgent/
‚îÇ   ‚îú‚îÄ‚îÄ ReasonerAgent/
‚îÇ   ‚îú‚îÄ‚îÄ BooksLibraryAgent/
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ graph/                  # –£–∑–ª—ã –∏ —Å–±–æ—Ä–∫–∞ LangGraph
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ llm_service/        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ LLM (—Ñ–∞–±—Ä–∏–∫–∞, –∞–¥–∞–ø—Ç–µ—Ä—ã, –∫—ç—à)
‚îÇ   ‚îî‚îÄ‚îÄ db_service/         # –†–∞–±–æ—Ç–∞ —Å –ë–î (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, —Å—Ö–µ–º–∞, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îú‚îÄ‚îÄ tool_registry.py    # –†–µ–µ—Å—Ç—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ control_registry.py # –†–µ–µ—Å—Ç—Ä —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤
‚îî‚îÄ‚îÄ api/                    # FastAPI-—ç–Ω–¥–ø–æ–∏–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–±—ë—Ä—Ç–∫–µ —Å `LIMIT`.
- –í–∞–ª–∏–¥–∞—Ü–∏—è SQL –ø—Ä–æ—Ç–∏–≤ —Å—Ö–µ–º—ã –∏ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü (`allowed_tables`).
- –ò–∑–æ–ª—è—Ü–∏—è control –∏ tool –∞–≥–µ–Ω—Ç–æ–≤ (control-–∞–≥–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã).
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ read-only –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤

- _¬´–ù–∞–π–¥–∏ –∫–Ω–∏–≥–∏ –ü—É—à–∫–∏–Ω–∞ –∏ —É–∫–∞–∂–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–∑ –Ω–∏—Ö?¬ª_
- _¬´–í –∫–∞–∫–∏—Ö –∞–∫—Ç–∞—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–µ–æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–∫–∞–∑–∞—Ö –ë–∞–Ω–∫–∞?¬ª_
- _¬´–ü–æ—Å—á–∏—Ç–∞–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ –∫–∞–∂–¥–æ–º—É —Ä–µ–≥–∏–æ–Ω—É –∑–∞ 2023 –≥–æ–¥¬ª_

---

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

- –í—Å–µ –∞–≥–µ–Ω—Ç—ã –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `BaseAgent` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `AgentResult`.
- –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ `TOOL_REGISTRY` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π.
- –ù–æ–≤—ã–µ LLM-–±—ç–∫–µ–Ω–¥—ã ‚Äî —á–µ—Ä–µ–∑ `adapters/` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ —Ñ–∞–±—Ä–∏–∫–µ.
- –ü—Ä–æ–º–ø—Ç—ã –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –ª–∏—Ü–µ–Ω–∑–∏–∏ (—É—Ç–æ—á–Ω–∏—Ç–µ —É –≤–ª–∞–¥–µ–ª—å—Ü–∞).

---

> üí° **–°–æ–≤–µ—Ç**: –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `run_planner.py` ‚Äî –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ PlannerAgent —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏ —É–≤–∏–¥–µ—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω.