def get_decomposition_system_prompt() -> str:
    return """
Ты — эксперт по декомпозиции сложных вопросов.
Твоя задача — разбить вопрос на **атомарные подвопросы**, ответы на которые **напрямую формируют итоговый ответ**.
Следуй этим правилам:
1. **Формулируй подвопросы как утверждения**, на которые можно дать фактологический ответ (да/нет, список, значение).
2. **Не описывай процесс выполнения** (не используй глаголы "получить", "найти", "проанализировать").
3. **Каждый подвопрос должен быть независимой частью итогового ответа**.
4. **Укажи зависимости**, если один подвопрос требует данных из другого.

### Стратегия для вопросов о содержимом документов (актов, книг и т.д.):
- **Шаг 1**: Получи список всех релевантных документов (актов, книг).
- **Шаг 2**: Отфильтруй документы по содержимому, связанному с запросом.

Примеры:
- ПЛОХО: "Получить список актов Банка."
- ХОРОШО: "Какие акты были изданы Банком?"
- ХОРОШО для содержимого: "Какие акты содержат упоминания 'необоснованных отказов'?"

Верни ТОЛЬКО валидный JSON в формате:
{
  "subquestions": [
    {
      "id": "q1",
      "text": "Атомарный подвопрос",
      "depends_on": []
    }
  ]
}
"""

def get_decomposition_user_prompt(question: str, tool_registry: dict) -> str:
    tools_desc = []
    for name, meta in tool_registry.items():
        # Получаем описание инструмента, если оно есть
        description = meta.get("description", "").strip()
        if description:
            description = f" — {description}"
        else:
            description = ""
        
        # Получаем список операций
        ops = ""
        for name_oper, oper in meta.get("operations", {}).items():
            desc = oper.get("description", {})
            ops = ops + f" {name_oper} ({desc})"
        
        # Формируем строку с названием, описанием и операциями
        tools_desc.append(f"- {name}{description}\n  Операции: {ops}")
    
    tools_text = "\n".join(tools_desc) if tools_desc else "(нет доступных инструментов)"

    return f"""
Пример правильной декомпозиции:
Вопрос: «Найди книги Пушкина и укажи главного героя в последней из них?»
Ответ:
{{
  "subquestions": [
    {{"id": "q1", "text": "Какие книги написал Пушкин?", "depends_on": []}},
    {{"id": "q2", "text": "Какая из книг Пушкина является последней по дате публикации?", "depends_on": ["q1"]}},
    {{"id": "q3", "text": "Кто является главным героем в последней книге Пушкина?", "depends_on": ["q2"]}}
  ]
}}

Теперь твоя очередь.
Вопрос: «{question}»
Доступные инструменты:
{tools_text}

Ответ:
"""